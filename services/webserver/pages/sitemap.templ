package pages

import (
	"fmt"
	"personal-website/internal"
	"personal-website/services/webserver/layouts"
	"time"
)

type Sitemap struct {
	Pages        []string
	Posts        []internal.Post
	LastModified time.Time
}

templ (p Sitemap) View() {
	{{
	totalPages := len(p.Pages) + len(p.Posts) + 3
	}}
	@layouts.Base{
		Pages:       p.Pages,
		PageCurrent: "sitemap",
		Title:       "Ethan Thoma / Site Map",
	}.View() {
		<article class="row-start-1 col-[2/-2]">
			<header class="font-mono">
				<h1 class="font-bold">
					ETHAN THOMA - SITE MAP
				</h1>
				<br/>
				<hr class="border-t-2 border-black border-dashed"/>
				<br/>
				<ul class="font-semibold text-content/80 text-s">
					<li>Last Updated: { time.Now().Format("2006-01-02 15:04 MST") }</li>
					<li>Page: sitemap</li>
					<li>Items: { fmt.Sprintf("%d", totalPages) }</li>
				</ul>
				<br/>
				<hr class="border-t-2 border-black border-dashed"/>
				<br/>
			</header>
			<section>
				<p>
					Complete directory of all pages, resources, and external 
					links available on this website. Use this index to navigate 
					to any section or find specific content.
				</p>
			</section>
			<br/>
			<hr class="border-t-2 border-black border-dashed"/>
			<br/>
			<section class="grid gap-x-[3ch] grid-cols-[3ch_max-content_1fr]">
				<h2 class="col-span-3 font-bold">Main Navigation</h2>
				<div class="col-span-3"><br/></div>
				@sitemapItem(0, "/home", "Home", "Personal information, contact details, and recent posts")
				@sitemapItem(1, "/blog", "Blog", "Technical posts, research notes, and thoughts")
				@sitemapItem(2, "/resources", "Resources", "Useful links, tools, and references")
				@sitemapItem(3, "/projects", "Projects", "Software projects, experiments, and code repositories")
				@sitemapItem(4, "/sitemap", "Site Map", "This page - complete site structure and navigation")
				<div class="col-span-3"><br/></div>
				<hr class="col-span-3 border-t-2 border-black border-dashed"/>
				<div class="col-span-3"><br/></div>
				<h2 class="col-span-3 font-bold">Resources & Files</h2>
				<div class="col-span-3"><br/></div>
				@sitemapItem(5, "https://raw.githubusercontent.com/ethanthoma/personal-website/main/docs/Resume.pdf", "Resume", "Current resume (PDF format)")
				@sitemapItem(6, "/robots.txt", "robots.txt", "Web crawler instructions")
				@sitemapItem(7, "/public/seo/sitemap.xml", "sitemap.xml", "XML sitemap for search engines")
				<div class="col-span-3"><br/></div>
				<hr class="col-span-3 border-t-2 border-black border-dashed"/>
				<div class="col-span-3"><br/></div>
				<h2 class="col-span-3 font-bold">Blog Posts</h2>
				<div class="col-span-3"><br/></div>
				for index, post := range p.Posts {
					@sitemapItem(8+index, "/blog/"+post.Slug, post.Title, fmt.Sprintf("Posted %s", post.Date.Format("2006-01-02")))
				}
				<div class="col-span-3"><br/></div>
				<hr class="col-span-3 border-t-2 border-black border-dashed"/>
				<div class="col-span-3"><br/></div>
				<h2 class="col-span-3 font-bold">External Links</h2>
				<div class="col-span-3"><br/></div>
				@sitemapItemLetter(0, "https://x.com/EthanBThoma", "Twitter/X", "@EthanBThoma - Updates and thoughts")
				@sitemapItemLetter(1, "https://github.com/ethanthoma", "GitHub", "Source code, repositories, and contributions")
				@sitemapItemLetter(2, "mailto:ethoma@mail.ubc.ca?subject=Professional/Academic Inquiry", "Email", "Professional and academic inquiries")
			</section>
		</article>
	}
}

templ sitemapItem(index int, url string, title string, description string) {
	<span class="font-mono">{ fmt.Sprintf("%03d", index) }</span>
	<a href={ templ.URL(url) } class="font-semibold hover:underline text-blue hover:text-darkblue" preload="mouseover">{ title }</a>
	<span class="text-content/80">{ description }</span>
}

templ sitemapItemLetter(index int, url string, title string, description string) {
	<span class="font-mono">{ fmt.Sprintf("A%02d", index) }</span>
	<a href={ templ.URL(url) } class="font-semibold hover:underline text-blue hover:text-darkblue" preload="mouseover">{ title }</a>
	<span class="text-content/80">{ description }</span>
}
